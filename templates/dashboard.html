<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Dev Learning Hub</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="/">
                    <span class="logo">DEV</span>
                    <span class="logo-accent">LEARNING</span>
                    <span class="logo">HUB</span>
                </a>
            </div>
            
            <div class="nav-menu">
                <div class="nav-links">
                    <a href="/dashboard" class="nav-link active">
                        <span class="nav-icon">🏠</span>
                        Dashboard
                    </a>
                    <a href="/quiz" class="nav-link">
                        <span class="nav-icon">🧠</span>
                        Quiz
                    </a>
                    <a href="/python-tutor" class="nav-link">
                        <span class="nav-icon">🐍</span>
                        DLH Tutor
                    </a>
                </div>
                
                <div class="nav-user">
                    <span class="user-name">{{ user.username }}</span>
                    <a href="/logout" class="logout-btn">Déconnexion</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container">
            <div class="dashboard-header">
                <h1>Bienvenue, {{ user.username }}!</h1>
                <p>Votre tableau de bord personnel</p>
            </div>
            
            <div class="dashboard-grid">
                <!-- Console Hacker -->
                <div class="dashboard-card console-card">
                    <div class="card-header">
                        <h3>🔧 Console Hacker</h3>
                    </div>
                    <div class="card-content">
                        <div id="terminal" class="terminal">
                            <div class="terminal-header">
                                <div class="terminal-buttons">
                                    <button onclick="clearTerminal()" class="terminal-btn">Clear</button>
                                    <button onclick="showHelp()" class="terminal-btn">Help</button>
                                    <button onclick="matrixRain()" class="terminal-btn">Matrix Rain</button>
                                    <button onclick="toggleFullscreen()" class="terminal-btn">Fullscreen</button>
                                </div>
                            </div>
                            <div id="terminal-content" class="terminal-content">
                                <div class="terminal-line">
                                    <span class="prompt">matrix@dlh:~$</span>
                                    <span class="command">Welcome to DLH Terminal</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="output">Type 'help' for available commands</span>
                                </div>
                                <div class="terminal-line">
                                    <span class="prompt">matrix@dlh:~$</span>
                                    <input type="text" id="terminal-input" class="terminal-input" autofocus>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Statistiques -->
                <div class="dashboard-card stats-card">
                    <div class="card-header">
                        <h3>📊 Vos Statistiques</h3>
                    </div>
                    <div class="card-content">
                        <div class="stats-grid">
                            <div class="stat-item">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Quiz Complétés</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">0%</div>
                                <div class="stat-label">Score Moyen</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">0</div>
                                <div class="stat-label">Codes Exécutés</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Actions Rapides -->
                <div class="dashboard-card actions-card">
                    <div class="card-header">
                        <h3>⚡ Actions Rapides</h3>
                    </div>
                    <div class="card-content">
                        <div class="actions-grid">
                            <a href="/quiz" class="action-btn">
                                <span class="action-icon">🧠</span>
                                <span class="action-label">Faire un Quiz</span>
                            </a>
                            <a href="/python-tutor" class="action-btn">
                                <span class="action-icon">🐍</span>
                                <span class="action-label">DLH Tutor</span>
                            </a>
                            <a href="#" class="action-btn">
                                <span class="action-icon">📚</span>
                                <span class="action-label">Cours</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/static/js/main.js"></script>
    <script>
        // Terminal simple pour FastAPI
        let isFullscreen = false;
        
        function clearTerminal() {
            const terminal = document.getElementById('terminal-content');
            terminal.innerHTML = `
                <div class="terminal-line">
                    <span class="prompt">matrix@dlh:~$</span>
                    <span class="command">Terminal cleared</span>
                </div>
                <div class="terminal-line">
                    <span class="prompt">matrix@dlh:~$</span>
                    <input type="text" id="terminal-input" class="terminal-input" autofocus>
                </div>
            `;
        }
        
        function showHelp() {
            const terminal = document.getElementById('terminal-content');
            const helpText = `
                <div class="terminal-line">
                    <span class="output">Available commands:</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  help - Show this help</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  clear - Clear terminal</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  whoami - Show current user</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  date - Show current date</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  matrix - Enable Matrix rain</span>
                </div>
                <div class="terminal-line">
                    <span class="output">  neo - Enter the Matrix</span>
                </div>
            `;
            terminal.insertAdjacentHTML('beforeend', helpText);
            
            // Add new input line
            const newLine = document.createElement('div');
            newLine.className = 'terminal-line';
            newLine.innerHTML = `
                <span class="prompt">matrix@dlh:~$</span>
                <input type="text" id="terminal-input" class="terminal-input" autofocus>
            `;
            terminal.appendChild(newLine);
            
            // Focus on new input
            document.getElementById('terminal-input').focus();
            setupTerminalInput();
        }
        
        function matrixRain() {
            const terminal = document.getElementById('terminal-content');
            let rainActive = terminal.classList.contains('matrix-rain-active');
            
            if (rainActive) {
                terminal.classList.remove('matrix-rain-active');
                const rainElements = terminal.querySelectorAll('.matrix-rain-char');
                rainElements.forEach(el => el.remove());
                return;
            }
            
            terminal.classList.add('matrix-rain-active');
            
            const matrixChars = '日ﾊﾐﾋｰｳｼﾅﾓﾆｻﾜﾂｵﾘｱﾎﾃﾏｹﾒｴｶｷﾑﾕﾗﾈﾄﾖﾀﾇｿﾍﾞﾌｺｴﾁ';
            const numColumns = Math.floor(terminal.offsetWidth / 15);
            
            for (let i = 0; i < numColumns; i++) {
                setTimeout(() => {
                    createMatrixColumn(i * 15, matrixChars);
                }, i * 100);
            }
            
            setTimeout(() => {
                if (terminal.classList.contains('matrix-rain-active')) {
                    matrixRain();
                }
            }, 10000);
        }
        
        function createMatrixColumn(x, chars) {
            const terminal = document.getElementById('terminal-content');
            const column = document.createElement('div');
            column.className = 'matrix-rain-char';
            column.style.cssText = `
                position: absolute;
                left: ${x}px;
                top: -20px;
                color: #00ff41;
                font-family: monospace;
                font-size: 14px;
                opacity: 0.7;
                z-index: 1000;
                pointer-events: none;
                animation: matrix-fall 3s linear infinite;
            `;
            
            let charStr = '';
            for (let i = 0; i < 20; i++) {
                charStr += chars[Math.floor(Math.random() * chars.length)] + '<br>';
            }
            column.innerHTML = charStr;
            
            terminal.appendChild(column);
            
            setTimeout(() => {
                if (column.parentNode) {
                    column.remove();
                }
            }, 3000);
        }
        
        function setupTerminalInput() {
            const input = document.getElementById('terminal-input');
            if (input) {
                input.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter') {
                        const command = this.value.trim();
                        processCommand(command);
                        this.value = '';
                    }
                });
            }
        }
        
        function processCommand(command) {
            const terminal = document.getElementById('terminal-content');
            const currentInput = document.getElementById('terminal-input');
            
            // Show the command that was typed
            if (currentInput && currentInput.parentElement) {
                currentInput.parentElement.innerHTML = `
                    <span class="prompt">matrix@dlh:~$</span>
                    <span class="command">${command}</span>
                `;
            }
            
            let response = '';
            switch(command.toLowerCase()) {
                case 'help':
                    showHelp();
                    return;
                case 'clear':
                    clearTerminal();
                    return;
                case 'whoami':
                    response = '{{ user.username if user else "anonymous" }}';
                    break;
                case 'date':
                    response = new Date().toLocaleString();
                    break;
                case 'matrix':
                    response = 'Entering the Matrix...';
                    setTimeout(() => matrixRain(), 1000);
                    break;
                case 'neo':
                    response = 'Wake up, Neo... The Matrix has you...';
                    break;
                case 'red pill':
                    response = 'Welcome to the real world.';
                    break;
                case 'blue pill':
                    response = 'The story ends, you wake up in your bed and believe whatever you want to believe.';
                    break;
                case '':
                    response = '';
                    break;
                default:
                    response = `Command not found: ${command}. Type 'help' for available commands.`;
            }
            
            // Add response
            if (response) {
                const responseLine = document.createElement('div');
                responseLine.className = 'terminal-line';
                responseLine.innerHTML = `<span class="output">${response}</span>`;
                terminal.appendChild(responseLine);
            }
            
            // Add new input line
            const newLine = document.createElement('div');
            newLine.className = 'terminal-line';
            newLine.innerHTML = `
                <span class="prompt">matrix@dlh:~$</span>
                <input type="text" id="terminal-input" class="terminal-input" autofocus>
            `;
            terminal.appendChild(newLine);
            
            // Setup event listener for new input
            setupTerminalInput();
            
            // Scroll to bottom
            terminal.scrollTop = terminal.scrollHeight;
        }
        
        // Initialize terminal when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setupTerminalInput();
        });

        function toggleFullscreen() {
            const terminal = document.getElementById('terminal');
            isFullscreen = !isFullscreen;
            
            if (isFullscreen) {
                terminal.classList.add('fullscreen');
            } else {
                terminal.classList.remove('fullscreen');
            }
        }
        
        // CSS pour la pluie Matrix
        if (!document.querySelector('#matrix-rain-styles')) {
            const style = document.createElement('style');
            style.id = 'matrix-rain-styles';
            style.textContent = `
                @keyframes matrix-fall {
                    0% { transform: translateY(-20px); opacity: 1; }
                    100% { transform: translateY(400px); opacity: 0; }
                }
                .matrix-rain-active {
                    position: relative;
                    overflow: hidden;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
</body>
</html>
