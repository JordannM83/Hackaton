{% extends "base.html" %}

{% block title %}Dashboard - Dev Learning Hub{% endblock %}

{% block content %}
<div class="dashboard-container">
    <div class="dashboard-header">
        <h1 class="dashboard-title">
            <span class="title-icon">📊</span>
            Tableau de bord
        </h1>
        <p class="dashboard-subtitle">
            Bienvenue, <span class="username-highlight">{{ user.username }}</span>
        </p>
    </div>
    
    <div class="dashboard-grid">
        <!-- Carte de profil -->
        <div class="dashboard-card profile-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">👤</span>
                    Mon Profil
                </h3>
            </div>
            <div class="card-content">
                <div class="profile-info">
                    <div class="profile-avatar">
                        <div class="avatar-placeholder">
                            {{ user.username[0].upper() }}
                        </div>
                    </div>
                    <div class="profile-details">
                        <p class="profile-name">{{ user.username }}</p>
                        <p class="profile-email">{{ user.email }}</p>
                        <p class="profile-role">
                            {% if user.is_admin %}
                                <span class="role-badge admin">🔰 Administrateur</span>
                            {% else %}
                                <span class="role-badge user">👤 Utilisateur</span>
                            {% endif %}
                        </p>
                        <p class="profile-date">
                            Membre depuis le {{ user.created_at.split(' ')[0] }}
                        </p>
                    </div>
                </div>
                <a href="{{ url_for('profile') }}" class="btn btn-secondary btn-small">
                    <span class="btn-icon">✏️</span>
                    Modifier
                </a>
            </div>
        </div>
        
        <!-- Statistiques -->
        <div class="dashboard-card stats-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">📈</span>
                    Progression
                </h3>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number">{{ user.level }}</div>
                        <div class="stat-label">Niveau</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user.xp_points }}</div>
                        <div class="stat-label">Points XP</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ user.total_quizzes }}</div>
                        <div class="stat-label">Quiz Complétés</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">{{ "%.1f"|format(user.completion_rate) }}%</div>
                        <div class="stat-label">Taux Réussite</div>
                    </div>
                </div>
                
                <!-- Barre de progression niveau -->
                <div class="level-progress">
                    <div class="progress-header">
                        <span class="progress-label">Niveau {{ user.level }} → {{ user.level + 1 }}</span>
                        <span class="progress-percent">{{ "%.0f"|format(level_progress) }}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" data-width="{{ level_progress }}"></div>
                    </div>
                    <div class="progress-info">
                        <span>{{ xp_for_next - (user.xp_points - ((user.level - 1) ** 2 * 100)) }} XP pour le niveau suivant</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Achievements récents -->
        {% if achievements %}
        <div class="dashboard-card achievements-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">🏆</span>
                    Achievements Récents
                </h3>
            </div>
            <div class="card-content">
                <div class="achievements-list">
                    {% for achievement in achievements %}
                    <div class="achievement-item">
                        <div class="achievement-icon">🏅</div>
                        <div class="achievement-content">
                            <div class="achievement-name">{{ achievement[0] }}</div>
                            <div class="achievement-desc">{{ achievement[1] }}</div>
                            <div class="achievement-date">{{ achievement[2].split(' ')[0] }}</div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Meilleure catégorie -->
        {% if user.best_category %}
        <div class="dashboard-card best-category-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">⭐</span>
                    Votre Spécialité
                </h3>
            </div>
            <div class="card-content">
                <div class="best-category">
                    <div class="category-name">{{ user.best_category }}</div>
                    <div class="category-desc">Votre domaine de prédilection !</div>
                </div>
            </div>
        </div>
        {% endif %}
        
        <!-- Actions rapides -->
        <div class="dashboard-card actions-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">⚡</span>
                    Actions Rapides
                </h3>
            </div>
            <div class="card-content">
                <div class="actions-grid">
                    <a href="{{ url_for('profile') }}" class="action-btn">
                        <span class="action-icon">👤</span>
                        <span class="action-text">Mon Profil</span>
                    </a>
                    <a href="{{ url_for('quiz_home') }}" class="action-btn quiz-action">
                        <span class="action-icon">🎯</span>
                        <span class="action-text">Quiz C</span>
                    </a>
                    {% if user.is_admin %}
                        <a href="{{ url_for('admin') }}" class="action-btn admin-action">
                            <span class="action-icon">⚙️</span>
                            <span class="action-text">Administration</span>
                        </a>
                    {% endif %}
                    <button class="action-btn" onclick="matrix()">
                        <span class="action-icon">🌧️</span>
                        <span class="action-text">Matrix Rain</span>
                    </button>
                    <button class="action-btn" onclick="glitch()">
                        <span class="action-icon">⚡</span>
                        <span class="action-text">Glitch Effect</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Activité récente -->
        <div class="dashboard-card activity-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">🕒</span>
                    Activité Récente
                </h3>
            </div>
            <div class="card-content">
                <div class="activity-list">
                    <div class="activity-item">
                        <div class="activity-icon">🔑</div>
                        <div class="activity-content">
                            <p class="activity-title">Connexion réussie</p>
                            <p class="activity-time">
                                {% if user.last_login %}
                                    {{ user.last_login.split(' ')[0] }}
                                {% else %}
                                    Première connexion
                                {% endif %}
                            </p>
                        </div>
                    </div>
                    <div class="activity-item">
                        <div class="activity-icon">📝</div>
                        <div class="activity-content">
                            <p class="activity-title">Compte créé</p>
                            <p class="activity-time">{{ user.created_at.split(' ')[0] }}</p>
                        </div>
                    </div>
                    {% if recent_scores %}
                        {% for score in recent_scores %}
                        <div class="activity-item">
                            <div class="activity-icon">🎯</div>
                            <div class="activity-content">
                                <p class="activity-title">Quiz {{ score.category }} complété</p>
                                <p class="activity-time">{{ score.completed_at.split(' ')[0] }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Console Easter Egg -->
        <div class="dashboard-card console-card">
            <div class="card-header">
                <h3 class="card-title">
                    <span class="card-icon">💻</span>
                    Console Hacker
                </h3>
            </div>
            <div class="card-content">
                <div class="console-terminal">
                    <div class="terminal-header">
                        <span class="terminal-title">~/hacker-console</span>
                    </div>
                    <div class="terminal-content">
                        <p class="terminal-line">
                            <span class="terminal-prompt">root@matrix:~$</span>
                            <span class="terminal-text">whoami</span>
                        </p>
                        <p class="terminal-line">{{ user.username }}</p>
                        <p class="terminal-line">
                            <span class="terminal-prompt">root@matrix:~$</span>
                            <span class="terminal-text">access_level</span>
                        </p>
                        <p class="terminal-line">
                            {% if user.is_admin %}ADMIN_ACCESS_GRANTED{% else %}USER_LEVEL_AUTHENTICATED{% endif %}
                        </p>
                        <p class="terminal-line">
                            <span class="terminal-prompt">root@matrix:~$</span>
                            <span class="terminal-cursor">|</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation d'entrée pour les cartes
    const cards = document.querySelectorAll('.dashboard-card');
    cards.forEach((card, index) => {
        card.style.animationDelay = `${index * 0.1}s`;
        card.classList.add('fade-in-up');
    });
    
    // Animation des barres de progression niveau
    setTimeout(() => {
        const progressFills = document.querySelectorAll('.progress-fill[data-width]');
        progressFills.forEach(fill => {
            const width = fill.getAttribute('data-width');
            fill.style.width = '0%';
            fill.style.transition = 'width 2s ease-out';
            setTimeout(() => {
                fill.style.width = width + '%';
            }, 500);
        });
    }, 1000);
    
    // Animation des achievements
    const achievements = document.querySelectorAll('.achievement-item');
    achievements.forEach((achievement, index) => {
        achievement.style.animationDelay = `${index * 0.2}s`;
        achievement.classList.add('slide-in-left');
    });
    
    // Animation du curseur terminal
    const cursor = document.querySelector('.terminal-cursor');
    if (cursor) {
        setInterval(() => {
            cursor.style.opacity = cursor.style.opacity === '0' ? '1' : '0';
        }, 500);
    }
    
    // Animation de la meilleure catégorie
    const bestCategory = document.querySelector('.best-category');
    if (bestCategory) {
        setTimeout(() => {
            bestCategory.classList.add('glow-effect');
        }, 2000);
    }
});

// Raccourcis clavier
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.shiftKey) {
        switch(e.key) {
            case 'D':
                e.preventDefault();
                // Déjà sur le dashboard
                break;
            case 'A':
                e.preventDefault();
                {% if user.is_admin %}
                    window.location.href = "{{ url_for('admin') }}";
                {% endif %}
                break;
            case 'L':
                e.preventDefault();
                window.location.href = "{{ url_for('logout') }}";
                break;
            case 'Q':
                e.preventDefault();
                window.location.href = "{{ url_for('quiz_home') }}";
                break;
        }
    }
    
    if (e.key === 'Escape') {
        // Fermer les éléments modaux s'ils existent
        const modals = document.querySelectorAll('.modal, .dropdown');
        modals.forEach(modal => modal.classList.remove('active'));
    }
});
</script>
{% endblock %}
