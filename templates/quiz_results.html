{% extends "base.html" %}

{% block title %}Résultats Quiz {{ results.category }} - Dev Learning Hub{% endblock %}

{% block content %}
<div class="quiz-results-container">
    <div class="results-header">
        <h1 class="results-title">
            <span class="title-icon">🎯</span>
            Résultats du Quiz
        </h1>
        <p class="results-subtitle">{{ results.category }}</p>
    </div>
    
    <div class="score-card">
        <div class="score-circle">
            <div class="score-number">{{ results.score }}/{{ results.total }}</div>
            <div class="score-percentage">{{ results.percentage }}%</div>
        </div>
        
        <div class="score-details">
            <h3 class="score-title">
                {% if results.percentage >= 80 %}
                    🏆 Excellent !
                {% elif results.percentage >= 60 %}
                    👍 Bien joué !
                {% elif results.percentage >= 40 %}
                    📚 Peut mieux faire
                {% else %}
                    💪 Continuez vos efforts !
                {% endif %}
            </h3>
            
            <div class="score-stats">
                <div class="stat-item">
                    <span class="stat-label">Bonnes réponses</span>
                    <span class="stat-value">{{ results.score }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total questions</span>
                    <span class="stat-value">{{ results.total }}</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Pourcentage</span>
                    <span class="stat-value">{{ results.percentage }}%</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Progression Display -->
    {% if results.progression %}
    <div class="progression-display">
        <h3 class="progression-title">
            <span class="progression-icon">📈</span>
            Progression
        </h3>
        
        {% if results.progression.level_up %}
        <div class="level-up-notification">
            🎉 NIVEAU SUPÉRIEUR ! Vous êtes maintenant niveau {{ results.progression.new_level }} ! 🎉
        </div>
        {% endif %}
        
        <div class="xp-gained">
            +{{ results.progression.xp_gained }} XP gagnés !
        </div>
        
        <div class="progression-stats">
            <div class="stat-group">
                <span class="stat-label">XP Total</span>
                <span class="stat-value">{{ results.progression.total_xp }}</span>
            </div>
            <div class="stat-group">
                <span class="stat-label">Niveau Actuel</span>
                <span class="stat-value">{{ results.progression.new_level }}</span>
            </div>
        </div>
        
        {% if results.achievements %}
        <div class="new-achievements">
            <h4 style="color: var(--primary-green); margin-bottom: var(--spacing-md); grid-column: 1 / -1;">
                🏆 Nouveaux Achievements !
            </h4>
            {% for achievement in results.achievements %}
            <div class="new-achievement">
                <div class="new-achievement-icon">🏅</div>
                <div class="new-achievement-name">{{ achievement[0] }}</div>
                <div class="new-achievement-desc">{{ achievement[1] }}</div>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    <div class="performance-badge">
        {% if results.percentage >= 90 %}
            <div class="badge expert">
                <span class="badge-icon">🌟</span>
                <span class="badge-text">Expert C</span>
            </div>
        {% elif results.percentage >= 80 %}
            <div class="badge advanced">
                <span class="badge-icon">🔥</span>
                <span class="badge-text">Niveau Avancé</span>
            </div>
        {% elif results.percentage >= 60 %}
            <div class="badge intermediate">
                <span class="badge-icon">📈</span>
                <span class="badge-text">Niveau Intermédiaire</span>
            </div>
        {% elif results.percentage >= 40 %}
            <div class="badge beginner">
                <span class="badge-icon">🌱</span>
                <span class="badge-text">Débutant</span>
            </div>
        {% else %}
            <div class="badge novice">
                <span class="badge-icon">📚</span>
                <span class="badge-text">À approfondir</span>
            </div>
        {% endif %}
    </div>
    
    <div class="answers-review">
        <h3 class="review-title">
            <span class="review-icon">📝</span>
            Révision des réponses
        </h3>
        
        {% for answer_data in results.answers %}
        <div class="answer-card {% if answer_data.is_correct %}correct{% else %}incorrect{% endif %}">
            <div class="answer-header">
                <span class="question-number">Q{{ loop.index }}</span>
                <span class="answer-status">
                    {% if answer_data.is_correct %}
                        <span class="status-icon correct">✅</span>
                        <span class="status-text">Bonne réponse</span>
                    {% else %}
                        <span class="status-icon incorrect">❌</span>
                        <span class="status-text">À revoir</span>
                    {% endif %}
                </span>
            </div>
            
            <div class="answer-content">
                <div class="question-section">
                    <h4 class="section-title">Question :</h4>
                    <p class="question-text">{{ answer_data.question }}</p>
                </div>
                
                <div class="user-answer-section">
                    <h4 class="section-title">Votre réponse :</h4>
                    <div class="user-answer">{{ answer_data.user_answer }}</div>
                </div>
                
                <div class="correct-answer-section">
                    <h4 class="section-title">Réponse attendue :</h4>
                    <div class="correct-answer">{{ answer_data.correct_answer }}</div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div class="results-actions">
        <a href="/quiz" class="btn btn-primary">
            <span class="btn-icon">🎯</span>
            Faire un autre Quiz
        </a>
        
        <a href="/quiz/category/{{ results.category }}" class="btn btn-secondary">
            <span class="btn-icon">🔄</span>
            Refaire ce Quiz
        </a>
        
        <a href="/dashboard" class="btn btn-secondary">
            <span class="btn-icon">📊</span>
            Voir mes Statistiques
        </a>
    </div>
    
    <div class="recommendations">
        <h3 class="recommendations-title">
            <span class="recommendations-icon">💡</span>
            Recommandations
        </h3>
        
        <div class="recommendations-content">
            {% if results.percentage >= 80 %}
                <div class="recommendation">
                    <span class="rec-icon">🚀</span>
                    <p>Excellent niveau ! Essayez les catégories plus avancées ou aidez d'autres développeurs.</p>
                </div>
            {% elif results.percentage >= 60 %}
                <div class="recommendation">
                    <span class="rec-icon">📖</span>
                    <p>Bon niveau ! Révisez les questions ratées et pratiquez avec des exercices de code.</p>
                </div>
            {% else %}
                <div class="recommendation">
                    <span class="rec-icon">📚</span>
                    <p>Continuez l'apprentissage ! Consultez la documentation C et pratiquez les bases.</p>
                </div>
                <div class="recommendation">
                    <span class="rec-icon">💻</span>
                    <p>Écrivez du code C régulièrement pour consolider vos connaissances.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/js/quiz_results.js"></script>
{% endblock %}
